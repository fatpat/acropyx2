(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[214],{2486:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/competitions",function(){return n(2348)}])},2348:function(e,t,n){"use strict";n.r(t);var r=n(8520),i=n.n(r),a=n(5893),o=n(7294),c=(n(1163),n(4713)),s=n(6886),u=n(5861),l=n(3321),d=n(9964),p=n(666),f=n(2474),h=n(1458),m=n(7357),x=n(6242),v=n(6540),w=n(8445),j=n(4267),g=n(2023),b=n(9624),y=n(9188),Z=n(7087),_=n(2359),k=n(4117),P=(n(7497),n(9780),n(5148)),E=n(9233);function S(e,t,n,r,i,a,o){try{var c=e[a](o),s=c.value}catch(u){return void n(u)}c.done?t(s):Promise.resolve(s).then(r,i)}function C(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){S(a,r,i,o,c,"next",e)}function c(e){S(a,r,i,o,c,"throw",e)}o(void 0)}))}}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){O(e,t,n[t])}))}return e}function T(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(s){i=!0,a=s}finally{try{r||null==c.return||c.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var X={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"600px",bgcolor:"background.paper",boxShadow:24,p:4};t.default=function(){var e,t,n=T((0,P.z)(),4),r=n[0],S=n[1],O=(n[2],n[3]),A=(0,c.aF)(),D=(A.user,A.authError,A.authIisLoading,(0,o.useState)([])),I=D[0],z=D[1],L=(0,o.useState)([]),F=L[0],V=L[1],W=(0,o.useState)([]),B=W[0],J=W[1],M=(0,o.useState)([]),R=(M[0],M[1]),U=(0,o.useState)([]),q=(U[0],U[1]),G=(0,o.useState)(!1),H=G[0],K=G[1],Q=(0,o.useState)(!1),Y=Q[0],$=Q[1],ee=(0,o.useState)(""),te=ee[0],ne=ee[1],re=(0,o.useState)({}),ie=re[0],ae=re[1],oe=C(i().mark((function e(){var t,n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return K(!0),e.t0=T,e.next=4,(0,E.X)("/competitions",{expect_json:!0});case 4:if(e.t1=e.sent,t=(0,e.t0)(e.t1,3),n=t[0],r=t[1],t[2],!n){e.next=14;break}return z(!1),V(!1),O("Error while retrieving competitions list: ".concat(n)),e.abrupt("return");case 14:r=r.map((function(e){return e.delete="delete",e.update="update",e.id=e._id,e})),z(r),V(r),K(!1);case 18:case"end":return e.stop()}}),e)}))),ce=C(i().mark((function e(){var t,n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=T,e.next=3,(0,E.X)("/pilots",{expect_json:!0});case 3:if(e.t1=e.sent,t=(0,e.t0)(e.t1,3),n=t[0],r=t[1],t[2],!n){e.next=12;break}return J([]),O("Error while retrieving judge levels: ".concat(n)),e.abrupt("return");case 12:J(r);case 13:case"end":return e.stop()}}),e)}))),se=C(i().mark((function e(){var t,n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=T,e.next=3,(0,E.X)("/judges",{expect_json:!0});case 3:if(e.t1=e.sent,t=(0,e.t0)(e.t1,3),n=t[0],r=t[1],t[2],!n){e.next=12;break}return R([]),O("Error while retrieving judge levels: ".concat(n)),e.abrupt("return");case 12:R(r);case 13:case"end":return e.stop()}}),e)}))),ue=C(i().mark((function e(){var t,n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=T,e.next=3,(0,E.X)("/tricks",{expect_json:!0});case 3:if(e.t1=e.sent,t=(0,e.t0)(e.t1,3),n=t[0],r=t[1],t[2],!n){e.next=12;break}return q([]),O("Error while retrieving judge levels: ".concat(n)),e.abrupt("return");case 12:q(r);case 13:case"end":return e.stop()}}),e)}))),le=C(i().mark((function e(t){var n,r,a,o,c,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),n="/competitions/new",r="POST",a=201,ie._id&&(n="/competitions/".concat(ie._id),r="PUT",a=204),ie.pilots=null!==(o=ie.pilots)&&void 0!==o?o:[],ie.pilots=ie.pilots.map((function(e){return e.civlid})),e.t0=T,e.next=11,(0,E.X)(n,{expected_status:a,method:r,headers:{"Content-Type":"application/json"},body:JSON.stringify(ie)});case 11:if(e.t1=e.sent,c=(0,e.t0)(e.t1,3),s=c[0],c[1],c[2],!s){e.next=19;break}return ie._id?O("error while updating competition ".concat(ie._id,": ").concat(s)):O("error while creating new competition: ".concat(s)),e.abrupt("return");case 19:$(!1),oe();case 21:case"end":return e.stop()}}),e)}))),de=(C(i().mark((function e(t){var n,a,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.target.dataset.id,confirm("Are you sure you want to delete Competition ".concat(name," (").concat(n,") ?"))){e.next=3;break}return e.abrupt("return");case 3:return K(!0),e.t0=T,e.next=7,(0,E.X)("/competitions/".concat(n),{method:"DELETE",expected_status:204});case 7:e.t1=e.sent,a=(0,e.t0)(e.t1,3),o=a[0],a[1],a[2],o?O("Error while deleting Competition ".concat(n,": ").concat(o)):r("Competition ".concat(n," successfully deleted")),oe();case 14:case"end":return e.stop()}}),e)}))),C(i().mark((function e(t){var n,r,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=(n=t.target.value).normalize("NFD").replace(/[\u0300-\u036f]/g,""),r=new RegExp(n,"i"),a=F.filter((function(e){return e.name.normalize("NFD").replace(/[\u0300-\u036f]/g,"").match(r)})),z(a),S("".concat(a.length," competitions filtered over ").concat(F.length));case 6:case"end":return e.stop()}}),e)}))));return(0,o.useEffect)((function(){oe(),ce(),se(),ue()}),[]),H?(0,a.jsxs)(m.Z,{sx:{width:"100%",textAlign:"center"},children:[(0,a.jsx)(h.Z,{}),"Loading"]}):I?(0,a.jsxs)(s.ZP,{container:!0,spacing:6,children:[(0,a.jsx)(s.ZP,{item:!0,xs:12,children:(0,a.jsxs)(u.Z,{variant:"h5",children:["Competitions",(0,a.jsx)(p.Z,{onClick:oe})]})}),(0,a.jsx)(s.ZP,{item:!0,xs:4,sm:4,children:(0,a.jsx)(f.Z,{fullWidth:!0,id:"outlined-basic",label:"Search competition",variant:"outlined",onChange:de})}),(0,a.jsxs)(s.ZP,{item:!0,xs:8,sm:8,container:!0,children:[(0,a.jsx)(l.Z,{variant:"contained",onClick:function(){ne("New competition"),ae({}),$(!0)},startIcon:(0,a.jsx)(v.Z,{}),children:"new competition"}),(0,a.jsx)(d.Z,{open:Y,onClose:function(){return $(!1)},"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:(0,a.jsx)(x.Z,{sx:X,children:(0,a.jsxs)("form",{onSubmit:le,children:[(0,a.jsx)(w.Z,{title:te,titleTypographyProps:{variant:"h6"}}),(0,a.jsx)(j.Z,{children:(0,a.jsxs)(s.ZP,{container:!0,spacing:5,children:[(0,a.jsx)(s.ZP,{item:!0,xs:12,children:(0,a.jsx)(f.Z,{fullWidth:!0,name:"name",label:"Name",placeholder:"Competition name",defaultValue:null!==(e=ie.name)&&void 0!==e?e:Date.now(),onChange:function(e){ie.name=e.target.value,ae(ie)}})}),(0,a.jsx)(s.ZP,{item:!0,xs:12,children:(0,a.jsx)(_._,{dateAdapter:Z.Z,children:(0,a.jsx)(y.M,{label:"Start Date",openTo:"day",views:["year","month","day"],value:null!==(t=ie.start_date)&&void 0!==t?t:"",onChange:function(e){ie.start_date=e,ae(ie)},renderInput:function(e){return(0,a.jsx)(f.Z,N({},e))}})})}),(0,a.jsx)(s.ZP,{item:!0,xs:12,children:(0,a.jsx)(b.Z,{disablePortal:!0,multiple:!0,id:"autocomplete-pilots",options:B,getOptionLabel:function(e){return"".concat(e.name," (").concat(e.civlid,")")},defaultValue:B.filter((function(e){return!!ie.pilots&&ie.pilots.find((function(t){return t.civlid==e.civlid}))})),renderInput:function(e){return(0,a.jsx)(f.Z,N({},e,{name:"pilots",label:"Pilots"}))},onChange:function(e,t){ie.pilots=t,ae(ie)}})})]})}),(0,a.jsxs)(g.Z,{children:[(0,a.jsx)(l.Z,{size:"large",type:"submit",sx:{mr:2},variant:"contained",children:"Submit"}),(0,a.jsx)(l.Z,{size:"large",color:"secondary",variant:"outlined",onClick:function(){return $(!1)},children:"Cancel"})]})]})})})]}),(0,a.jsx)(s.ZP,{item:!0,xs:12,children:(0,a.jsx)(x.Z,{children:(0,a.jsx)(k.Z,{rows:I,headCells:[{id:"name"},{id:"type"},{id:"start_date"},{id:"end_date"},{id:"pilots",rewrite:function(e,t){return"solo"==t.type?"".concat(e.length," pilots"):"N/A"}},{id:"teams",rewrite:function(e,t){return"synchro"==t.type?"".concat(e.length," teams"):"N/A"}},{id:"judges",rewrite:function(e,t){return"".concat(e.length," judges")}},{id:"runs",rewrite:function(e,t){return"".concat(e.length," runs")}}],orderById:"name"})})})]}):(O("Empty or invalid data"),"")}}},function(e){e.O(0,[824,698,251,610,595,307,774,888,179],(function(){return t=2486,e(e.s=t);var t}));var t=e.O();_N_E=t}]);