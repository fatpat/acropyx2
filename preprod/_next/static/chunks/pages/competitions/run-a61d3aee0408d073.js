(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[824],{454:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/competitions/run",function(){return n(6736)}])},6736:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Q}});var r=n(8520),s=n.n(r),i=n(5893),a=n(7294),c=n(1163),o=n(4713),u=n(6886),l=n(5861),d=n(3321),p=n(666),f=n(1458),x=n(7357),h=n(6242),m=n(122),v=n(298),j=n(5050),y=n(5670),g=n(1496),Z=n(44),b=n(1036),w=n(1395),k=n(4496),P=n(1300),_=n(594),T=n(7440),C=(n(4803),n(4117)),E=(n(7497),n(9780),n(5148)),S=n(9233),I=(n(1194),n(3521),n(7250),n(3740),n(4451)),R=n(3798),A=n(8321),O=n(4906),N=n(4267);function X(e,t,n,r,s,i,a){try{var c=e[i](a),o=c.value}catch(u){return void n(u)}c.done?t(o):Promise.resolve(o).then(r,s)}function J(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,s=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(o){s=!0,i=o}finally{try{r||null==c.return||c.return()}finally{if(s)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var H=function(e){var t,n=e.code,r=e.rid,c=J((0,E.z)(),4),o=(c[0],c[1],c[2],c[3]),d=(0,a.useState)(!1),p=d[0],f=d[1],x=(t=s().mark((function e(){var t,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=J,e.next=3,(0,S.Xv)("/competitions/".concat(n,"/results/").concat(r),{expect_json:!0});case 3:if(e.t1=e.sent,t=(0,e.t0)(e.t1,3),i=t[0],a=t[1],t[2],!i){e.next=12;break}return o("error while retrieving results for competition ".concat(n,": ").concat(i)),f(!1),e.abrupt("return");case 12:a.results=a.results.map((function(e,t){return e.rank=t+1,e})),f(a);case 14:case"end":return e.stop()}}),e)})),function(){var e=this,n=arguments;return new Promise((function(r,s){var i=t.apply(e,n);function a(e){X(i,r,s,a,c,"next",e)}function c(e){X(i,r,s,a,c,"throw",e)}a(void 0)}))});return(0,a.useEffect)((function(){x()}),[]),p?(0,i.jsxs)(N.Z,{children:[(0,i.jsxs)(l.Z,{varian:"h2",children:[p.final?"Final":"Intermediate"," results"]}),(0,i.jsx)(u.ZP,{container:!0,spacing:7,children:(0,i.jsx)(u.ZP,{item:!0,xs:12,sm:12,children:(0,i.jsx)(C.Z,{rows:p.results,headCells:[{id:"rank"},{id:"pilot",rewrite:function(e){return e.name}},{id:"score",numeric:!0}],orderById:"rank"})})})]}):"loading ..."},z=n(1736);function B(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,s=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(o){s=!0,i=o}finally{try{r||null==c.return||c.return()}finally{if(s)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var L,F=function(e){e.comp;var t=e.run,n=(e.rid,B((0,E.z)(),4));n[0],n[1],n[2],n[3];return(0,a.useEffect)((function(){}),[]),(0,i.jsx)(N.Z,{children:(0,i.jsx)(u.ZP,{container:!0,spacing:7,children:(0,i.jsx)(u.ZP,{item:!0,xs:12,sm:12,children:(0,i.jsx)(C.Z,{rows:t.flights,headCells:[{id:"rank"},{id:"pilot",rewrite:function(e){return e.name}},{id:"score",numeric:!0}],orderById:"rank"})})})})};function D(e,t,n,r,s,i,a){try{var c=e[i](a),o=c.value}catch(u){return void n(u)}c.done?t(o):Promise.resolve(o).then(r,s)}function W(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var i=e.apply(t,n);function a(e){D(i,r,s,a,c,"next",e)}function c(e){D(i,r,s,a,c,"throw",e)}a(void 0)}))}}function q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function G(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,s=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(o){s=!0,i=o}finally{try{r||null==c.return||c.return()}finally{if(s)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var K=(0,g.ZP)(Z.Z)((function(e){var t=e.theme;return q(L={},t.breakpoints.down("md"),{minWidth:100}),q(L,t.breakpoints.down("sm"),{minWidth:67}),L})),M=(0,g.ZP)("span")((function(e){var t=e.theme;return q({lineHeight:1.71,fontSize:"0.875rem",marginLeft:t.spacing(2.4)},t.breakpoints.down("md"),{display:"none"})})),Q=function(){var e=(0,c.useRouter)(),t=e.query,n=t.cid,r=t.rid,g=G((0,E.z)(),4),Z=g[0],C=(g[1],g[2],g[3]),N=(0,o.aF)(),X=(N.user,N.authError,N.authIisLoading,(0,a.useState)(!1)),J=X[0],B=X[1],L=(0,a.useState)(!1),D=L[0],q=L[1],Q=(0,a.useState)({}),U=Q[0],V=Q[1],Y=(0,a.useState)(!1),$=Y[0],ee=Y[1],te=(0,a.useState)("actions"),ne=te[0],re=te[1],se=G((0,S.Rs)(),1)[0],ie=((0,a.useRef)(),(0,a.useRef)(),(0,a.useRef)(),(0,a.useRef)(),(0,a.useRef)(),W(s().mark((function e(){var t,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ee(!0),e.t0=G,e.next=4,(0,S.Xv)("/competitions/".concat(n),{expect_json:!0});case 4:if(e.t1=e.sent,t=(0,e.t0)(e.t1,3),i=t[0],a=t[1],t[2],!i){e.next=15;break}return B(!1),q(!1),V(!1),C("Error while retrieving competitions list: ".concat(i)),e.abrupt("return");case 15:a.delete="delete",a.update="update",a.id=a._id,B(a),q(a.runs[r]),V(Object.assign({},a)),ee(!1);case 22:case"end":return e.stop()}}),e)})))),ae=W(s().mark((function e(t){var i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(confirm("Are you sure to ".concat(t," run ").concat(r," of competition ").concat(n," ?"))){e.next=2;break}return e.abrupt("return");case 2:return e.t0=G,e.next=5,(0,S.Xv)("/competitions/".concat(n,"/runs/").concat(r,"/").concat(t),{expected_status:204,method:"POST"});case 5:if(e.t1=e.sent,i=(0,e.t0)(e.t1,3),a=i[0],i[1],i[2],!a){e.next=13;break}return C("error while ".concat(t," run ").concat(r," of competition ").concat(n,": ").concat(a)),e.abrupt("return");case 13:ie();case 14:case"end":return e.stop()}}),e)}))),ce=W(s().mark((function e(t){var i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=G,e.next=3,(0,S.Xv)("/competitions/".concat(n,"/runs/").concat(r,"/pilots"),{expected_status:204,method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.map((function(e){return e.civlid})))});case 3:if(e.t1=e.sent,i=(0,e.t0)(e.t1,3),a=i[0],i[1],i[2],!a){e.next=11;break}return C("error while updating pilots list ".concat(n,": ").concat(a)),e.abrupt("return");case 11:ie();case 12:case"end":return e.stop()}}),e)}))),oe=W(s().mark((function e(t){var i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=G,e.next=3,(0,S.Xv)("/competitions/".concat(n,"/runs/").concat(r,"/teams"),{expected_status:204,method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.map((function(e){return e.id})))});case 3:if(e.t1=e.sent,i=(0,e.t0)(e.t1,3),a=i[0],i[1],i[2],!a){e.next=11;break}return C("error while updating teams list ".concat(n,": ").concat(a)),e.abrupt("return");case 11:ie();case 12:case"end":return e.stop()}}),e)}))),ue=W(s().mark((function e(t){var i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=G,e.next=3,(0,S.Xv)("/competitions/".concat(n,"/runs/").concat(r,"/judges"),{expected_status:204,method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.map((function(e){return e.id})))});case 3:if(e.t1=e.sent,i=(0,e.t0)(e.t1,3),a=i[0],i[1],i[2],!a){e.next=11;break}return C("error while updating judges list ".concat(n,": ").concat(a)),e.abrupt("return");case 11:ie();case 12:case"end":return e.stop()}}),e)}))),le=W(s().mark((function e(t){var i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=G,e.next=3,(0,S.Xv)("/competitions/".concat(n,"/runs/").concat(r,"/repeatable_tricks"),{expected_status:204,method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.map((function(e){return e.id})))});case 3:if(e.t1=e.sent,i=(0,e.t0)(e.t1,3),a=i[0],i[1],i[2],!a){e.next=11;break}return C("error while updating repeatable tricks list ".concat(n,": ").concat(a)),e.abrupt("return");case 11:ie();case 12:case"end":return e.stop()}}),e)}))),de=W(s().mark((function e(t){var i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=G,e.next=3,(0,S.Xv)("/competitions/".concat(n,"/runs/").concat(r,"/config"),{expected_status:204,method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});case 3:if(e.t1=e.sent,i=(0,e.t0)(e.t1,3),a=i[0],i[1],i[2],!a){e.next=11;break}return C("error while updating config ".concat(n,": ").concat(a)),e.abrupt("return");case 11:ie();case 12:case"end":return e.stop()}}),e)})));W(s().mark((function e(t){var i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return alert("No yet implemented! #TODO"),e.abrupt("return");case 5:return ee(!0),e.t0=G,e.next=9,(0,S.Xv)("/competitions/".concat(undefined,"/runs/").concat(r),{method:"DELETE",expected_status:204});case 9:e.t1=e.sent,i=(0,e.t0)(e.t1,3),a=i[0],i[1],i[2],a?C("Error while deleting run #".concat(r," from competition ").concat(n,": ").concat(a)):Z("Run #".concat(r," from competition ").concat(n," successfully deleted")),ie();case 16:case"end":return e.stop()}}),e)})));return(0,a.useEffect)((function(){e.isReady&&ie()}),[e.isReady]),$||!e.isReady?(0,i.jsxs)(x.Z,{sx:{width:"100%",textAlign:"center"},children:[(0,i.jsx)(f.Z,{}),"Loading"]}):J&&D?(0,i.jsxs)(u.ZP,{container:!0,spacing:6,children:[(0,i.jsxs)(u.ZP,{item:!0,xs:12,children:[(0,i.jsx)(l.Z,{variant:"h6",children:(0,i.jsx)(m.Z,{href:"/competitions/show?cid=".concat(J.code),children:J.name})}),(0,i.jsxs)(l.Z,{variant:"h3",children:["Run #",r,(0,i.jsx)(p.Z,{onClick:ie})]})]}),(0,i.jsxs)(u.ZP,{item:!0,xs:12,md:6,sx:{paddingBottom:4},children:[(0,i.jsxs)(l.Z,{children:["Status: ",(0,i.jsx)("strong",{children:D.state}),"init"==D.state&&(0,i.jsx)(d.Z,{variant:"outlined",startIcon:(0,i.jsx)(P.Z,{}),onClick:function(){return ae("open")},children:"Open"}),"open"==D.state&&(0,i.jsx)(d.Z,{variant:"outlined",startIcon:(0,i.jsx)(_.Z,{}),onClick:function(){return ae("close")},children:"Close"}),"closed"==D.state&&(0,i.jsx)(d.Z,{variant:"outlined",startIcon:(0,i.jsx)(T.Z,{}),onClick:function(){return ae("reopen")},children:"Reopen"})]}),(0,i.jsxs)(l.Z,{children:["Type: ",(0,i.jsx)("strong",{children:U.type})]})]}),(0,i.jsx)(u.ZP,{item:!0,xs:12,children:(0,i.jsx)(h.Z,{children:(0,i.jsxs)(y.ZP,{value:ne,children:[(0,i.jsxs)(v.Z,{onChange:function(e,t){re(t)},"aria-label":"account-settings tabs",sx:{borderBottom:function(e){return"1px solid ".concat(e.palette.divider)}},children:["solo"==J.type&&(0,i.jsx)(K,{value:"pilots",label:(0,i.jsxs)(x.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,i.jsx)(w.Z,{}),(0,i.jsx)(M,{children:"Pilots"})]})}),"synchro"==J.type&&(0,i.jsx)(K,{value:"teams",label:(0,i.jsxs)(x.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,i.jsx)(w.Z,{}),(0,i.jsx)(M,{children:"Teams"})]})}),(0,i.jsx)(K,{value:"judges",label:(0,i.jsxs)(x.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,i.jsx)(w.Z,{}),(0,i.jsx)(M,{children:"Judges"})]})}),(0,i.jsx)(K,{value:"repeatable_tricks",label:(0,i.jsxs)(x.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,i.jsx)(k.Z,{}),(0,i.jsx)(M,{children:"Repeatables tricks"})]})}),(0,i.jsx)(K,{value:"settings",label:(0,i.jsxs)(x.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,i.jsx)(k.Z,{}),(0,i.jsx)(M,{children:"Run Settings"})]})}),(0,i.jsx)(K,{value:"flights",label:(0,i.jsxs)(x.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,i.jsx)(b.Z,{}),(0,i.jsx)(M,{children:"Flights"})]})}),(0,i.jsx)(K,{value:"results",label:(0,i.jsxs)(x.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,i.jsx)(k.Z,{}),(0,i.jsx)(M,{children:"Results"})]})})]}),(0,i.jsx)(j.Z,{sx:{p:0},value:"pilots",children:(0,i.jsx)(R.Z,{pilots:D.pilots,allPilots:J.pilots,update:function(e){return ce(e)}})}),(0,i.jsx)(j.Z,{sx:{p:0},value:"teams",children:(0,i.jsx)(I.Z,{teams:D.teams,allTeams:J.teams,update:function(e){return oe(e)}})}),(0,i.jsx)(j.Z,{sx:{p:0},value:"judges",children:(0,i.jsx)(A.Z,{judges:D.judges,allJudges:J.judges,update:function(e){return ue(e)}})}),(0,i.jsx)(j.Z,{sx:{p:0},value:"repeatable_tricks",children:(0,i.jsx)(z.Z,{tricks:D.repeatable_tricks,allTricks:se,update:function(e){return le(e)}})}),(0,i.jsx)(j.Z,{sx:{p:0},value:"settings",children:(0,i.jsx)(O.Z,{config:D.config,update:function(e){return de(e)},type:J.type})}),(0,i.jsx)(j.Z,{sx:{p:0},value:"flights",children:(0,i.jsx)(F,{comp:J,run:D,rid:r})}),(0,i.jsx)(j.Z,{sx:{p:0},value:"results",children:(0,i.jsx)(H,{code:n,rid:r})})]})})})]}):(C("Empty or invalid data"),"")}}},function(e){e.O(0,[885,549,698,109,725,404,323,335,595,774,888,179],(function(){return t=454,e(e.s=t);var t}));var t=e.O();_N_E=t}]);